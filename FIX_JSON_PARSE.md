# ä¿®å¤ processed_pdfs.json è§£æé”™è¯¯

## ğŸ› é—®é¢˜æ ¹æº

é”™è¯¯ä¿¡æ¯ï¼š
```
SyntaxError: Unexpected token < in JSON at position 0
at JSON.parse (<anonymous>)
at main (file:///...scripts/process-pdfs.ts:288:26)
```

**æ ¹æœ¬åŸå› **ï¼šç¬¬ 288 è¡Œæ˜¯è¯»å– `data/processed_pdfs.json` æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶å¯èƒ½ï¼š
1. åŒ…å« HTML å†…å®¹ï¼ˆä»¥ `<` å¼€å¤´ï¼‰
2. æ ¼å¼æŸå
3. ä¸æ˜¯æœ‰æ•ˆçš„ JSON

---

## âœ… å·²å®æ–½çš„ä¿®å¤

### å¢å¼º JSON æ–‡ä»¶è¯»å–çš„å®¹é”™æ€§

```typescript
// ä¹‹å‰ï¼ˆä¼š crashï¼‰ï¼š
processed = JSON.parse(fs.readFileSync(PROCESSED_LEDGER_PATH, 'utf-8'));

// ç°åœ¨ï¼ˆé˜²å¾¡æ€§ç¼–ç¨‹ï¼‰ï¼š
try {
  const content = fs.readFileSync(PROCESSED_LEDGER_PATH, 'utf-8').trim();
  if (content && content.startsWith('[')) {
    processed = JSON.parse(content);
  } else {
    console.warn('âš ï¸  processed_pdfs.json æ ¼å¼ä¸æ­£ç¡®ï¼Œå°†é‡ç½®ä¸ºç©ºæ•°ç»„');
    processed = [];
  }
} catch (e) {
  console.error('âš ï¸  è¯»å– processed_pdfs.json å¤±è´¥ï¼Œå°†é‡ç½®ä¸ºç©ºæ•°ç»„');
  console.error('é”™è¯¯:', e);
  processed = [];
}
```

**æ”¹è¿›ç‚¹**ï¼š
1. âœ… æ·»åŠ  try-catch æ•è·å¼‚å¸¸
2. âœ… æ£€æŸ¥å†…å®¹æ˜¯å¦ä»¥ `[` å¼€å¤´ï¼ˆæœ‰æ•ˆçš„ JSON æ•°ç»„ï¼‰
3. âœ… å¦‚æœæ–‡ä»¶æŸåï¼Œé‡ç½®ä¸ºç©ºæ•°ç»„è€Œä¸æ˜¯ crash
4. âœ… æ‰“å°è­¦å‘Šä¿¡æ¯ï¼Œä¾¿äºè°ƒè¯•

---

## ğŸ“‹ æäº¤å’Œæµ‹è¯•

### æäº¤å‘½ä»¤

```bash
cd "/Users/lesley/Desktop/GitHub/Research Web/research-website"

git add scripts/process-pdfs.ts

git commit -m "fix: å¢å¼º processed_pdfs.json è¯»å–çš„å®¹é”™æ€§

- æ·»åŠ  try-catch æ•è· JSON è§£æé”™è¯¯
- æ£€æŸ¥æ–‡ä»¶å†…å®¹æ ¼å¼æ˜¯å¦æœ‰æ•ˆ
- æ–‡ä»¶æŸåæ—¶é‡ç½®ä¸ºç©ºæ•°ç»„è€Œä¸æ˜¯ crash
- æ·»åŠ è¯¦ç»†çš„è­¦å‘Šæ—¥å¿—"

git push origin main
```

---

### æµ‹è¯•æ­¥éª¤

1. **æ¨é€ä¿®å¤**
2. **æ‰‹åŠ¨è§¦å‘ GitHub Actions**
3. **æŸ¥çœ‹æ—¥å¿—**ï¼Œåº”è¯¥çœ‹åˆ°ï¼š
   - å¦‚æœæ–‡ä»¶æ­£å¸¸ï¼šç›´æ¥å¤„ç† PDF
   - å¦‚æœæ–‡ä»¶æŸåï¼šæ˜¾ç¤ºè­¦å‘Šå¹¶ç»§ç»­

---

## ğŸ¯ é¢„æœŸç»“æœ

### åœºæ™¯ 1: processed_pdfs.json æ­£å¸¸
```
å•ç¯‡æ¨¡å¼ï¼šä»…å¤„ç† ã€ç¡•è¿œå’¨è¯¢ã€‘2025å¹´ä¸­å›½å†œäº§å“åŠ å·¥è¡Œä¸šç ”ç©¶æŠ¥å‘Š.pdf

========================================
å¼€å§‹å¤„ç†ï¼šã€ç¡•è¿œå’¨è¯¢ã€‘2025å¹´ä¸­å›½å†œäº§å“åŠ å·¥è¡Œä¸šç ”ç©¶æŠ¥å‘Š.pdf
========================================

æ­¥éª¤ 1/5: æå– PDF æ–‡æœ¬...
âœ… æå–æˆåŠŸï¼Œæ–‡æœ¬é•¿åº¦: 12345 å­—ç¬¦

æ­¥éª¤ 2/5: è°ƒç”¨ DeepSeek API åˆ†æå†…å®¹...
ğŸ”‘ Current API Key starts with: sk-ab...
ğŸ“¤ æ­£åœ¨è°ƒç”¨ DeepSeek API...
âœ… API è°ƒç”¨æˆåŠŸ
...
```

### åœºæ™¯ 2: processed_pdfs.json æŸå
```
âš ï¸  processed_pdfs.json æ ¼å¼ä¸æ­£ç¡®ï¼Œå°†é‡ç½®ä¸ºç©ºæ•°ç»„

å•ç¯‡æ¨¡å¼ï¼šä»…å¤„ç† ã€ç¡•è¿œå’¨è¯¢ã€‘2025å¹´ä¸­å›½å†œäº§å“åŠ å·¥è¡Œä¸šç ”ç©¶æŠ¥å‘Š.pdf
...
```

### åœºæ™¯ 3: processed_pdfs.json ä¸å­˜åœ¨
```
å•ç¯‡æ¨¡å¼ï¼šä»…å¤„ç† ã€ç¡•è¿œå’¨è¯¢ã€‘2025å¹´ä¸­å›½å†œäº§å“åŠ å·¥è¡Œä¸šç ”ç©¶æŠ¥å‘Š.pdf
...
```

---

## ğŸ” å…¶ä»–å¯èƒ½çš„é—®é¢˜

å¦‚æœä¿®å¤åè¿˜æ˜¯å¤±è´¥ï¼Œå¯èƒ½æ˜¯ï¼š

### 1. API Key ä»ç„¶ä¸æ­£ç¡®
æŸ¥çœ‹æ—¥å¿—ä¸­çš„ï¼š
```
ğŸ”‘ Current API Key starts with: sk-xx...
```
ç¡®è®¤å‰ 5 ä½æ˜¯å¦æ­£ç¡®

### 2. API è°ƒç”¨å¤±è´¥
æŸ¥çœ‹æ—¥å¿—ä¸­çš„ï¼š
```
âŒ DeepSeek API è°ƒç”¨å¤±è´¥ï¼
ğŸ“Š å“åº”çŠ¶æ€ç : 401
```

### 3. ç½‘ç»œé—®é¢˜
```
ğŸ“¡ è¯·æ±‚å·²å‘é€ä½†æ²¡æœ‰æ”¶åˆ°å“åº”
```

---

## ğŸ“ å®Œæ•´çš„è°ƒè¯•ä¿¡æ¯

ä¿®å¤åçš„è„šæœ¬ä¼šæ‰“å°ï¼š
1. âœ… API Key å‰ 5 ä½
2. âœ… API è°ƒç”¨çŠ¶æ€
3. âœ… è¿”å›å†…å®¹ï¼ˆå‰ 500 å­—ç¬¦ï¼‰
4. âœ… JSON æå–è¿‡ç¨‹
5. âœ… è§£æç»“æœ

**ç°åœ¨æäº¤ä¿®å¤å¹¶æµ‹è¯•ï¼** ğŸš€

